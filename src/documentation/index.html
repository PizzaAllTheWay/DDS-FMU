<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>dds-fmu: Introduction</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  extensions: ["tex2jax.js"],
  jax: ["input/TeX","output/HTML-CSS"],
});
</script>
<script type="text/javascript" async="async" src="https://cdn.jsdelivr.net/npm/mathjax@2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="custom.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">dds-fmu<span id="projectnumber">&#160;0.5.1</span>
   </div>
   <div id="projectbrief">DDS-FMU communication integration</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Introduction </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_index"></a></p><ul>
<li><b>dds-fmu main rationale</b>: Integrate DDS-based software in FMI simulations.</li>
<li><b>Core feature</b>: Incorporates DDS signals in FMI simulations in a simple manner.</li>
<li><b>No need for code compilation</b>: Just 1) decompress the FMU; 2) configure it; 3) zip it back to an FMU.</li>
<li>For <b>Quick start</b>: Jump to <a class="el" href="index.html#sec_quickstart">Usage</a>.</li>
</ul>
<div class="image">
<img src="diagram.png" alt=""/>
<div class="caption">
System overview for DDS-FMU.</div></div>
    <p >OMG DDS <b>[omg-dds-2015]</b> is a standard for a data-centric publish and subscribe scheme, which is devised by the Object Management Group (OMG). It defines a set of quality of services (QoS) for data distribution service (DDS). This includes APIs and communication semantics, where real-time publish subscribe (RTPS) <b>[omg-dds-rtps-2022]</b> is one such protocol that aims to provide interoperability between DDS implementations from different vendors.</p>
<p >Functional mock-up interface (FMI) <b>[fmi-standard-2023]</b> is a widely used standard that defines containers and interfaces for exchanging dynamical simulation models. As defined by the FMI standard, an FMU (Functional Mock-up Unit) is essentially a zip archive that implements the FMI standard for a specific 'system' in form of binaries, code, configuration files, et cetera.</p>
<p >DDS can be used as a communication middleware for components in a software system. These components can consist of graphical user interfaces, hardware instruments, software components, for instance control systems or business logic units. Suppose one such component is a control system module or sensor acquisition module. If the purpose is to use the DDS component together with other FMUs, one needs to somehow translate between the different APIs. One option is to integrate the DDS component directly in an FMU, but this requires access to the software code for proper integration. An alternative, less invasive, approach is to use an adaptation layer that translates between DDS and FMI.</p>
<p ><code>dds-fmu</code> implements the latter approach and is inspired by eProsima's Integration Service <b>[eprosima-integration-service-2023]</b>. <code>dds-fmu</code> is <b>extensible</b>: the user can create a customised FMU by providing new IDL files and mappings between DDS pub/sub types and FMI inputs/outputs. <code>dds-fmu</code> is <b>configurable</b>: it comes bundled with all necessary tools to generate <code>modelDescription.xml</code>, which is consistent with the custom configuration. <code>dds-fmu</code> customisation has no need for a code compiler and no new binary files are created.</p>
<h1><a class="anchor" id="sec_quickstart"></a>
Usage</h1>
<p >A typical workflow can be summarised with these main steps:</p>
<ul>
<li>Change directory: <code>cd /to/path/with/dds-fmu.fmu</code></li>
<li>Decompress the FMU: <code>unzip dds-fmu.fmu</code></li>
<li>Edit configuration files in <code>resources/config/</code>, see details in <a class="el" href="index.html#sec_configuration">Configuration</a>.</li>
<li>[ ] Make bundled tool executable (Linux): <code>chmod +x resources/tools/linux64/repacker</code></li>
<li>Create a new FMU: <code>resources/tools/linux64/repacker create -v -o dds-fmu.fmu /to/path/with/</code></li>
</ul>
<h2><a class="anchor" id="sec_configuration"></a>
Configuration</h2>
<p >Preparing the FMU for a customised setup is done by editing configuration files, which are located in the <code>resources</code> folder. The layout of this folder can be seen in the figure below. Typically, a customisation consists of editing three files, which will be elaborated below:</p>
<ol type="1">
<li><code><a class="el" href="dds-fmu_8idl_source.html">dds-fmu.idl</a></code> Data type specification with IDL files (<a class="el" href="index.html#sec_idl">Data type specification with IDL</a>).</li>
<li><code>ddsfmu_mapping.xml</code> DDS-to-FMU mapping (<a class="el" href="index.html#sec_ddsfmu">DDS-to-FMU mapping</a>).</li>
<li><code>dds_profile.xml</code> Fast-DDS XML profiles (<a class="el" href="index.html#sec_profiles">Fast-DDS XML profiles</a>).</li>
</ol>
<div class="image">
<object type="image/svg+xml" data="resources.svg" style="pointer-events: none;"></object>
<div class="caption">
Folder structure of the resources directory.</div></div>
    <h3><a class="anchor" id="sec_idl"></a>
Data type specification with IDL</h3>
<p >The IDL standard <b>[omg-idl-2018]</b> is a descriptive way to define data types and more. We make use of it to define data structures on DDS that we want to integrate with FMU. The basic notation is not unlike regular C++ and in the listing below we provide an example, which cover many use cases.</p>
<div class="fragment"><div class="line"><span class="preprocessor">#pragma once</span></div>
<div class="line"> </div>
<div class="line">module <a class="code hl_namespace" href="namespaceidl.html">idl</a> {</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">enum</span> MyEnum { SLEEP, OKAY, ALERT, FAILURE, DEAD };</div>
<div class="line"> </div>
<div class="line">  <span class="keyword">struct </span>Klass {</div>
<div class="line">    <span class="keywordtype">string</span> str;      </div>
<div class="line">    @key uint8 ui8;  </div>
<div class="line">    int32 i32;       </div>
<div class="line">    int64 i64;       </div>
<div class="line">    <span class="keywordtype">double</span> d_val;    </div>
<div class="line">    <span class="keywordtype">float</span> f_val;     </div>
<div class="line">    <span class="keywordtype">boolean</span> enabled; </div>
<div class="line">    MyEnum status;   </div>
<div class="line">    <span class="keywordtype">float</span> my_array [10];     </div>
<div class="line">    uint32 my_matrix [3][2]; </div>
<div class="line">  };</div>
<div class="line"> </div>
<div class="line">};</div>
<div class="ttc" id="anamespaceidl_html"><div class="ttname"><a href="namespaceidl.html">idl</a></div><div class="ttdoc">Some example data structures used as DDS types, which can be mapped to signals in FMI.</div><div class="ttdef"><b>Definition:</b> dds-fmu.idl:4</div></div>
</div><!-- fragment --><p >Suppose the contents above are added to <code><a class="el" href="dds-fmu_8idl_source.html">dds-fmu.idl</a></code>, the file will be parsed by the FMU, and <code>idl::Klass</code> becomes available as a type.</p>
<h3><a class="anchor" id="sec_ddsfmu"></a>
DDS-to-FMU mapping</h3>
<p >The file <code>ddsfmu_mapping.xml</code> contains elements that specify which DDS topics to map to FMU inputs and outputs, see figure below. The <em>topic</em> attribute is a name identifier for a DDS Topic entity. Each topic is associated with a data <em>type</em>, which in our case is defined by our IDL file. Note that <b>FMU outputs</b> are <b>subscribed</b> DDS signals, and <b>FMU inputs</b> are <b>published</b> DDS signals. <b>DDS input = FMU output</b> and <b>DDS output = FMU inputs</b>. The user defines the necessary of FMU inputs and outputs using <code>&lt;fmu_in&gt;</code> and <code>&lt;fmu_out&gt;</code> elements, respectively. See the listing below for an example. For each element of <code>&lt;fmu_in&gt;</code> a DDS DataWriter is created, and likewise, for each <code>&lt;fmu_out&gt;</code> a DDS DataReader. The attribute <em>key_filter</em> of the <code>&lt;fmu_out&gt;</code> node indicates whether the FMU should perform key filtering on the output signals. This is disabled by default, which would result in all data on the topic being processed by the DDS DataReader. If it is enabled, on the other hand, corresponding FMU parameters will be generated in the <code>modelDescription.xml</code>.</p>
<div class="image">
<object type="image/svg+xml" data="ddsfmu-mapping.svg" style="pointer-events: none;"></object>
<div class="caption">
`ddsfmu_mapping` XML specification.</div></div>
    <div class="fragment"><div class="line">&lt;<span class="keywordtype">ddsfmu</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">fmu_in</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;ToPublish&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;idl::Klass&quot;</span> /&gt;</div>
<div class="line">  &lt;<span class="keywordtype">fmu_out</span> <span class="keyword">topic</span>=<span class="stringliteral">&quot;ToSubscribe&quot;</span> <span class="keyword">type</span>=<span class="stringliteral">&quot;idl::Klass&quot;</span> <span class="keyword">key_filter</span>=<span class="stringliteral">&quot;true&quot;</span> /&gt;</div>
<div class="line">&lt;/<span class="keywordtype">ddsfmu</span>&gt;</div>
</div><!-- fragment --><p >The <code>repacker</code> tool generates the <code>modelDescription.xml</code> based on this mapping. Suppose the unzipped contents with modified configuration files is located in <code>/my/custom/fmu</code>. By running the commands below, the user can inspect the generated <code>/my/custom/fmu/modelDescription.xml</code>.</p>
<div class="fragment"><div class="line">cd /my/custom/fmu</div>
<div class="line">resources/tools/linux64/repacker generate .</div>
</div><!-- fragment --><h3><a class="anchor" id="sec_profiles"></a>
Fast-DDS XML profiles</h3>
<p >A user can configure the Fast-DDS to a great extent by means of XML profiles. Central concepts such as domain id, QoS (like durability and reliability), and much more are configured using configuration profiles for various DDS entities. These profiles are loaded by purposefully specifying the <code>profile_name</code> attribute for an element type, see the figure below. The profiles for <em>participant</em>, <em>publisher</em>, and <em>subscriber</em> are attempted loaded by <code>profile_name="dds-fmu-default"</code>, with fallback to builtin default QoS. Profiles for <code>topic</code>, <code>data_writer</code>, and <code>data_reader</code> elements are attempted loaded by <code>profile_name="[topic]"</code>, where <em>topic</em> is as defined in &lt;fig:ddsfmu&gt;, with fallback to default QoS. This means that the user can specify custom profiles for specific <code>topic</code>, <code>data_reader</code>, and <code>data_writer</code> entities. XML profile documentation for each DDS entity type can be found on Fast-DDS online documentation <b>[eprosima-fast-dds-xml-profiles-2023]</b>. The FMU comes with an example <code>dds_profile.xml</code>, which can be edited as needed.</p>
<div class="image">
<object type="image/svg+xml" data="xml-profiles.svg" style="pointer-events: none;"></object>
<div class="caption">
`dds_profile` XML layout, where `n_w` is number of data readers and `n_r` is number of data readers.</div></div>
    <p >Continuing the example from previous sections, it could be necessary to add custom QoS for the <code>data_writer</code>. Then, the <code>dds_profile.xml</code> would contain an element as indicated below.</p>
<div class="fragment"><div class="line">&lt;<span class="keywordtype">dds</span>&gt;</div>
<div class="line">  &lt;<span class="keywordtype">profiles</span>&gt;</div>
<div class="line">    ...</div>
<div class="line">    &lt;<span class="keywordtype">data_writer</span> <span class="keyword">profile_name</span>=<span class="stringliteral">&quot;ToPublish&quot;</span>&gt;</div>
<div class="line">      &lt;<span class="keywordtype">qos</span>&gt;</div>
<div class="line">        &lt;<span class="keywordtype">reliability</span>&gt;</div>
<div class="line">          &lt;<span class="keywordtype">kind</span>&gt;<span class="keyword">RELIABLE</span>&lt;/<span class="keywordtype">kind</span>&gt;</div>
<div class="line">        &lt;/<span class="keywordtype">reliability</span>&gt;</div>
<div class="line">      &lt;/<span class="keywordtype">qos</span>&gt;</div>
<div class="line">    &lt;/<span class="keywordtype">data_writer</span>&gt;</div>
<div class="line">  &lt;/<span class="keywordtype">profiles</span>&gt;</div>
<div class="line">&lt;/<span class="keywordtype">dds</span>&gt;</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md1"></a>
Implementation overview</h1>
<p >DDS supports data exchange of user-defined data structures. These are often defined using an interface definition language (IDL), whose grammar is specified by the OMG IDL <b>[omg-idl-2018]</b>. What the IDL files defines, can be represented as dynamic types through the XTypes API specification <b>[omg-dds-xtypes-2020]</b>. <code>dds-fmu</code> makes use of this standard through a vendor implementation, namely <code>eProsima xtypes</code> <b>[eprosima-xtypes-2023]</b>. Moreover, <code>dds-fmu</code> uses <code>eProsima Fast-DDS</code> <b>[eprosima-fast-dds-2023]</b>, which implements DDS RTPS. <code>dds-fmu</code> parses IDL files into xtypes DynamicData and, with the help of code taken from <b>[eprosima-integration-service-2023]</b>, converts between xtypes DynamicData and Fast-DDS DynamicData. As a result, <code>dds-fmu</code> supports DDS communication with data types defined in IDL files without the need for code compilation. The xTypes API facilitates access to members of DynamicData in a way that infers the type kind of each member. <code>dds-fmu</code> makes use of this feature to ensure that each member is read or write accessed as the appropriate primitive type, as supported from the FMU side. Since <code>dds-fmu</code> is a co-simulation FMU, the implementation of the API is achieved with the help of <code>cppfmu</code> <b>[cppfmu-2023]</b>. Currently, <code>dds-fmu</code> supports FMI 2.0, which means that there are some limitations in terms of mapping from DynamicData member types to FMI types, see table below for an overview of supported data type mapping.</p>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">Type kind   </th><th class="markdownTableHeadNone">FMI 2.0 type   </th><th class="markdownTableHeadNone">Comment   </th><th class="markdownTableHeadNone"></th><th class="markdownTableHeadNone">Type kind   </th><th class="markdownTableHeadNone">Comment    </th></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">boolean   </td><td class="markdownTableBodyNone">fmiBoolean   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">long double   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">int8   </td><td class="markdownTableBodyNone">fmiInteger   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">char16   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint8   </td><td class="markdownTableBodyNone">fmiInteger   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">wide char   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">int16   </td><td class="markdownTableBodyNone">fmiInteger   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">bitset   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint16   </td><td class="markdownTableBodyNone">fmiInteger   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">sequence type   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">int32   </td><td class="markdownTableBodyNone">fmiInteger   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">wstring   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint32   </td><td class="markdownTableBodyNone">fmiReal   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone">map type   </td><td class="markdownTableBodyNone">N/A    </td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">int64   </td><td class="markdownTableBodyNone">fmiReal   </td><td class="markdownTableBodyNone">Lossy   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">uint64   </td><td class="markdownTableBodyNone">fmiReal   </td><td class="markdownTableBodyNone">Lossy   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">float   </td><td class="markdownTableBodyNone">fmiReal   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">double   </td><td class="markdownTableBodyNone">fmiReal   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">string   </td><td class="markdownTableBodyNone">fmiString   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowOdd">
<td class="markdownTableBodyNone">char8   </td><td class="markdownTableBodyNone">fmiString   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
<tr class="markdownTableRowEven">
<td class="markdownTableBodyNone">enumeration   </td><td class="markdownTableBodyNone">fmiInteger   </td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td><td class="markdownTableBodyNone"></td></tr>
</table>
<h2><a class="anchor" id="autotoc_md2"></a>
Data structure demultiplexing and model description</h2>
<p >An IDL data structure can be complex, with non-primitive types and nested data structures. These members needs to be demultiplexed in a way that allows the scalar variable access interface of FMI 2.0 to read or write member variables. This must be done in a manner that correctly casts to their primitive type. While parsing a requested DynamicData variable, <code>dds-fmu</code> instantiates visitor functions for read and write, with appropriate reference to the DynamicData's primitive type, as well as casting for input and output types. These visitor functions are stored in vectors in such a way that with so-called value references, they can be directly accessed by FMU setters and getters.</p>
<p ><code>dds-fmu</code> comes bundled with an executable command line tool for generating <code>modelDescription.xml</code>. In short: given <code>IDL</code> files, Fast-DDS configuration files, and a DDS-to-FMU mapping specification, the tool automatically generates <code>modelDescription.xml</code>. The output model description creates <code>&lt;ModelVariables&gt;</code> elements with <code>&lt;ScalarVariable&gt;</code> entries, and <code>&lt;ModelStructure&gt;</code> element with <code>&lt;Outputs&gt;</code>. All the <code>&lt;ScalarVariables&gt;</code> entries have attribute <code>variability=discrete</code> when they consist solely of inputs and outputs: <code>causality=input|output</code>. If there are any <code>@key</code> variables, additional entries with <code>causality=parameter</code> and <code>variability=fixed</code> will be created. The generated <code>&lt;ScalarVariable&gt;</code> entries have <code>name</code> attribute based on the FMI standard's <code>structured</code> variable naming convention. The variable name is constructed as <code>name=[pubsub].[topic name].[structured name]</code>, where <code>topic name</code> is as prescribed in the DDS-to-FMU mapping specification file, and <code>pubsub</code> is <code>pub</code> for input and <code>sub</code> for output. For <code>@key</code> parameters, they will have naming <code>name=key.sub.[topic name].[structured name]</code>.</p>
<h2><a class="anchor" id="autotoc_md3"></a>
Configuration of DDS entities and QoS settings</h2>
<p >Each instance of <code>dds-fmu</code> only creates a single DDS Participant, DDS Publisher, and DDS Subscriber. As a consequence, the QoS settings for these entities will be the same for all DDS DataReaders and DDS DataWriters in the current FMU instance. However, it is possible to specify QoS for each DataReader and DataWriter. The QoS settings for all mentioned entities are set through Fast-DDS XML profiles. These profiles are documented in the <a href="https://fast-dds.docs.eprosima.com/en/latest/fastdds/xml_configuration/making_xml_profiles.html">Fast-DDS documentation</a> <b>[eprosima-fast-dds-xml-profiles-2023]</b>. This setup may not suit complex use cases. Then, one approach would entail splitting the DDS mapping into multiple FMUs. For details on how to do profile configuration, see <a class="el" href="index.html#sec_quickstart">Usage</a>.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Data flow</h2>
<p >The interaction with DDS reader and writer entities are done in each call to DoStep() on the FMI side. Writing DDS data is done before reading. If the reader QoS is configured to have history greater than one, all data is fetched, but only the latest sample is kept. Effectively, this approach is a sample and hold. See the figure below for a sequence diagram of DoStep().</p>
<div class="image">
<object type="image/svg+xml" data="sequence.svg" style="pointer-events: none;"></object>
<div class="caption">
Sequence of actions in DoStep().</div></div>
    <h2><a class="anchor" id="autotoc_md5"></a>
Limitations and caveats</h2>
<p >There are some things the user should be aware of to avoid unnecessary troubleshooting. Below we list several points and in some cases suggest workarounds.</p>
<ul>
<li><b>Lost samples:</b> Only the last read sample is kept. Samples may therefore be lost, decrease step size.</li>
<li><b>Old samples lingers:</b> There is no expiration of sampled data. Frozen signals are not detected.<ul>
<li><code>key_filter</code> With key filtering this can become particularly evident.</li>
</ul>
</li>
<li><b>Sending to itself is possible:</b> The data flow is implemented so that write occurs before read; there will be a sample lag.</li>
<li><b>Loss of precision:</b> Some data types cannot easily be represented with available FMI 2.0 types. In such cases, another data type is used, which may lead to loss of precision.</li>
<li><b>Several FMU instances is conditionally possible:</b> Do not use multiple <code>dds-fmu</code> instances in the simulator instance if they are on the same DDS Domain ID. There are workarounds for some simulators. In the case of <code>cosim</code> <b>[cosim-2023]</b> you can use <code>proxyfmu</code> <b>[cosim-2023-proxyfmu]</b> on additional <code>dds-fmu</code> instances.</li>
</ul>
<h2><a class="anchor" id="autotoc_md6"></a>
Missing features</h2>
<ul>
<li>Allow using preprocessor when parsing IDL files (e.g. use <code>#include "file.idl"</code> in the IDL).</li>
<li>Sequence types, e.g. <code>std::vector&lt;TYPE&gt;</code></li>
<li>Limited support for IDL annotations.<ul>
<li><code>@key</code> partially supported: primitive types, string and enumerations. This excludes directly on structs, or array-like members.</li>
<li><code>@optional</code> and <code>@id</code> is supported by the IDL parser via a patch, but ignored by our implementation</li>
</ul>
</li>
<li>FMI 3.0 support </li>
</ul>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
